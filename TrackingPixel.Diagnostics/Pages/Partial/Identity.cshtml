@page "/partial/identity"
@using TrackingPixel.Diagnostics.Services
@inject MetricsService Metrics

@{
    Layout = null;
    var devices = (await Metrics.GetCrossNetworkDevicesAsync()).ToList();
}

@if (devices.Any())
{
    <table>
        <thead>
            <tr>
                <th>Fingerprint</th>
                <th>Device</th>
                <th>IPs</th>
                <th>Hits</th>
                <th>First Seen</th>
                <th>Last Seen</th>
                <th>Networks</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var d in devices.Take(50))
            {
                <tr>
                    <td><code>@d.DeviceFingerprint.Substring(0, Math.Min(8, d.DeviceFingerprint.Length))</code></td>
                    <td>@d.DeviceType</td>
                    <td><span class="badge badge-success">@d.UniqueIPs</span></td>
                    <td>@d.TotalHits</td>
                    <td>@d.FirstSeen.ToString("MM/dd HH:mm")</td>
                    <td>@d.LastSeen.ToString("MM/dd HH:mm")</td>
                    <td style="font-size: 0.8rem; color: #888;">@(d.IPList?.Length > 50 ? d.IPList.Substring(0, 50) + "..." : d.IPList)</td>
                </tr>
            }
        </tbody>
    </table>
    <p style="margin-top: 1rem; color: #66bb6a; font-size: 0.9rem;">
        ðŸ’¡ These @devices.Count device(s) have been tracked across multiple networks/IPs â€” demonstrating cookieless cross-network identity.
    </p>
}
else
{
    <div style="text-align: center; padding: 2rem; color: #888;">
        <p>No cross-network devices detected yet</p>
        <p style="font-size: 0.9rem;">Devices will appear here when they're seen from multiple IP addresses.</p>
    </div>
}
